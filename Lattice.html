<!DOCTYPE HTML>
<html>
  <head>
    <style>
        body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body> 
      
    <div id="container"></div>
    <script src="src/jquery-2.0.3.min.js"></script>
    <script src="src/jquery-ui.min.js"></script>
    <script src="src/three.min.js"></script>
    <script src="src/EdgesHelper.js"></script>
    <script src="src/OrbitControls.js"></script>
    <script src="src/dat.gui.min.js"></script>
    <script>

        
var gui, parameters;
var renderer, scene, camera, controls;
var aPlaneMesh, cPlaneMesh, mPlaneMesh, rPlaneMesh;
var egh;

init();
animate();

function init() {

	// info
	info = document.createElement( 'div' );
	info.style.position = 'absolute';
	info.style.top = '30px';
	info.style.width = '100%';
	info.style.textAlign = 'center';
	info.style.color = '#fff';
	info.style.fontWeight = 'bold';
	info.style.backgroundColor = 'transparent';
	info.style.zIndex = '1';
	info.style.fontFamily = 'Monospace';
	info.innerHTML = 'Lattice Demo';
	document.body.appendChild( info );

	// renderer
	renderer = new THREE.WebGLRenderer( { antialias: true } );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.physicallyBasedShading = true;
	document.body.appendChild( renderer.domElement );

	// scene
	scene = new THREE.Scene();
	
	// camera
	camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 0.1, 100 );
	camera.position.set( -4, 2, 8 );

	// controls
	controls = new THREE.OrbitControls( camera );
	controls.minDistance = 5;
	controls.maxDistance = 20;
	

	// ambient
	scene.add( new THREE.AmbientLight( 0x222222 ) );
	
	// light
	var light = new THREE.PointLight( 0x222222, 0.8 );
	light.position = camera.position;
	scene.add( light );

	// Unit Cell
	var Lattice = new THREE.CylinderGeometry( 1, 1, 2, 6, 1, false );
	Lattice.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );
	var LatticeMaterial = new THREE.MeshBasicMaterial( {
		color: 0x000000,
		shading: THREE.FlatShading,
		polygonOffset: true,
		polygonOffsetFactor: 1,
		polygonOffsetUnits: 1,
		transparent: true,
		opacity: .5
	} );
	// mesh
	var LatticeMesh = new THREE.Mesh( Lattice, LatticeMaterial );
	scene.add( LatticeMesh );

	// helper
	egh = new THREE.EdgesHelper( LatticeMesh, 0xFFFFFF );
	egh.material.transparent = true;
	egh.material.linewidth = 5;
	scene.add( egh );
	
	var vertices = Lattice.vertices;											       

	//c plane
	var cPlaneColor = new THREE.Color( 0xFF0000 );       
    	var cPlane = new THREE.Geometry();
	cPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	cPlane.vertices.push( vertices[0] );
        cPlane.vertices.push( vertices[1] );
        cPlane.vertices.push( vertices[2] );
        cPlane.vertices.push( vertices[3] );
        cPlane.vertices.push( vertices[4] );
        cPlane.vertices.push( vertices[5] );
        cPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        cPlane.faces.push( new THREE.Face3( 0, 2, 3) );
        cPlane.faces.push( new THREE.Face3( 0, 3, 4) );
        cPlane.faces.push( new THREE.Face3( 0, 4, 5) );
        cPlane.computeBoundingSphere();

        //a plane
	var aPlaneColor = new THREE.Color( 0x0000FF );       
        var aPlane = new THREE.Geometry();
	aPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	aPlane.vertices.push( vertices[2] );
        aPlane.vertices.push( vertices[0] );
        aPlane.vertices.push( vertices[7] );
        aPlane.vertices.push( vertices[9] );
        aPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        aPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        aPlane.computeBoundingSphere();
        
        //m plane
	var mPlaneColor = new THREE.Color( 0x00FF00 );       
        var mPlane = new THREE.Geometry();
	mPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	mPlane.vertices.push( vertices[1] );
        mPlane.vertices.push( vertices[0] );
        mPlane.vertices.push( vertices[7] );
        mPlane.vertices.push( vertices[8] );
        mPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        mPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        mPlane.computeBoundingSphere();
        
        //r plane
	var rPlaneColor = new THREE.Color( 0xFFFF00 );       
        var rPlane = new THREE.Geometry();
	rPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	rPlane.vertices.push( vertices[4] );
        rPlane.vertices.push( vertices[1] );
        rPlane.vertices.push( vertices[7] );
        rPlane.vertices.push( vertices[12] );
        rPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        rPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        rPlane.computeBoundingSphere();
    

    function axis() {
    	var z = vertices[7].z;
    	var bottom = new THREE.Vector3(0,0,z);
    	
    	var geometry = new THREE.Geometry();
    	geometry.vertices.push(vertices[12]);
    	geometry.vertices.push(bottom);
    	
    	var geometry2 = new THREE.Geometry();
    	geometry2.vertices.push(vertices[8]);
    	geometry2.vertices.push(bottom);
    	
    	var geometry3 = new THREE.Geometry();
    	geometry3.vertices.push(vertices[10]);
    	geometry3.vertices.push(bottom);
    	
    	var geometry4 = new THREE.Geometry();
    	geometry4.vertices.push(new THREE.Vector3(0,0,vertices[1].z));
    	geometry5.vertices.push(bottom);
    	
    	THREE.GeometryUtils.merge(geometry, geometry2);
    	THREE.GeometryUtils.merge(geometry, geometry3);
    	THREE.GeometryUtils.merge(geometry, geometry4);
    	
    	return geometry;	
    }
    
    var cMaterial = new THREE.MeshBasicMaterial( {
		color: cPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );

    var aMaterial = new THREE.MeshBasicMaterial( {
		color: aPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
    var mMaterial = new THREE.MeshBasicMaterial( {
		color: mPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
   var rMaterial = new THREE.MeshBasicMaterial( {
		color: rPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
   var axisMaterial = new THREE.LineBasicMaterial({
        color: 0x0000ff
    });
	
    cPlaneMesh = new THREE.Mesh(cPlane, cMaterial );
    scene.add( cPlaneMesh );

    aPlaneMesh = new THREE.Mesh(aPlane, aMaterial );
    scene.add( aPlaneMesh );
    
    mPlaneMesh = new THREE.Mesh(mPlane, mMaterial );
    scene.add( mPlaneMesh );
    
    rPlaneMesh = new THREE.Mesh(rPlane, rMaterial );
    scene.add( rPlaneMesh );
    
    var axis = new THREE.Line(axis(), axisMaterial);
    scene.add( axis );

    //setup GUI
    gui = new dat.GUI();
    parameters = 
	{
	cPlaneVisible: true,
        aPlaneVisible: true,
        mPlaneVisible: true,
        rPlaneVisible: true,
        axisVisible: false,
		reset: function() { resetLattice() }
	};
    var cPlaneVisible = gui.add( parameters, 'cPlaneVisible' ).name('C Plane').listen();
	cPlaneVisible.onChange(function(value) 
	{   //c Plane
        if(value) scene.add( cPlaneMesh );
        
        else scene.remove(cPlaneMesh);
        
    });
     var aPlaneVisible = gui.add( parameters, 'aPlaneVisible' ).name('A Plane').listen();
	aPlaneVisible.onChange(function(value) 
	{   //c Plane
    	if(value) scene.add( aPlaneMesh );
        
        else scene.remove(aPlaneMesh);
    });
     var mPlaneVisible = gui.add( parameters, 'mPlaneVisible' ).name('M Plane').listen();
	mPlaneVisible.onChange(function(value) 
	{   //c Plane
    	if(value) scene.add( mPlaneMesh );
        
        else scene.remove(mPlaneMesh);
    });
    var rPlaneVisible = gui.add( parameters, 'rPlaneVisible' ).name('R Plane').listen();
	rPlaneVisible.onChange(function(value) 
	{   //c Plane
    	if(value) scene.add( rPlaneMesh );
        
        else scene.remove(rPlaneMesh);
    });
    var axisVisible = gui.add( parameters, 'axisVisible' ).name('Axis').listen();
	axisVisible.onChange(function(value) 
	{   //c Plane
    
    });
    gui.add( parameters, 'reset' ).name("Reset");
    gui.open();
}

function animate() {

	requestAnimationFrame( animate );  
	renderer.render( scene, camera );
    update();
}
 
function resetLattice()
{
    
}      

function update()
{
    /*
	if ( keyboard.pressed("a") ) {
    
    }
	if ( keyboard.pressed("m") ) {
    
    }
	if ( keyboard.pressed("r") ) {
    
    }
	*/
    
	controls.update();
	//stats.update();
}
</script>
  </body>
</html>
