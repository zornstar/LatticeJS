<!DOCTYPE HTML>
<html>
  <head>
    <style>
        body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body> 
      
    <div id="container"></div>
    <script src="src/jquery-2.0.3.min.js"></script>
    <script src="src/jquery-ui.min.js"></script>
    <script src="src/three.min.js"></script>
    <script src="src/EdgesHelper.js"></script>
    <script src="src/OrbitControls.js"></script>
    <script src="src/dat.gui.min.js"></script>
    <script src="src/fonts/helvetiker_regular.typeface.js"></script>
    <script>

        
var gui, parameters;
var renderer, scene, camera, controls;
var aPlaneMesh, cPlaneMesh, mPlaneMesh, rPlaneMesh;
var egh;

init();
animate();

function init() {

	// info
	info = document.createElement( 'div' );
	info.style.position = 'absolute';
	info.style.top = '30px';
	info.style.width = '100%';
	info.style.textAlign = 'center';
	info.style.color = '#fff';
	info.style.fontWeight = 'bold';
	info.style.backgroundColor = 'transparent';
	info.style.zIndex = '1';
	info.style.fontFamily = 'Monospace';
	info.innerHTML = 'Lattice Demo';
	document.body.appendChild( info );

	// renderer
	renderer = new THREE.WebGLRenderer( { antialias: true } );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.physicallyBasedShading = true;
	document.body.appendChild( renderer.domElement );

	// scene
	scene = new THREE.Scene();
	
	// camera
	camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 0.1, 100 );
	camera.position.set( -4, 2, 8 );

	// controls
	controls = new THREE.OrbitControls( camera );
	controls.minDistance = 5;
	controls.maxDistance = 20;
	

	// ambient
	scene.add( new THREE.AmbientLight( 0x222222 ) );
	
	// light
	var light = new THREE.PointLight( 0x222222, 0.8 );
	light.position = camera.position;
	scene.add( light );

	// Unit Cell
	var Lattice = new THREE.CylinderGeometry( 1, 1, 2, 6, 1, false );
	Lattice.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );
	var LatticeMaterial = new THREE.MeshBasicMaterial( {
		shading: THREE.FlatShading,
		polygonOffset: true,
		polygonOffsetFactor: 1,
		polygonOffsetUnits: 1,
		transparent: true,
		opacity: 0
	} );
	// mesh
	var LatticeMesh = new THREE.Mesh( Lattice, LatticeMaterial );
	LatticeMesh.doubleSided = true;
	scene.add( LatticeMesh );

	// helper
	egh = new THREE.EdgesHelper( LatticeMesh, 0xFFFFFF );
	egh.material.transparent = true;
	egh.material.linewidth = 10;
	scene.add( egh );
	
	var vertices = Lattice.vertices;											       

	//c plane
	var cPlaneColor = new THREE.Color( 0xFFFF00 );       
    	var cPlane = new THREE.Geometry();
	cPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	cPlane.vertices.push( vertices[0] );
        cPlane.vertices.push( vertices[1] );
        cPlane.vertices.push( vertices[2] );
        cPlane.vertices.push( vertices[3] );
        cPlane.vertices.push( vertices[4] );
        cPlane.vertices.push( vertices[5] );
        cPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        cPlane.faces.push( new THREE.Face3( 0, 2, 3) );
        cPlane.faces.push( new THREE.Face3( 0, 3, 4) );
        cPlane.faces.push( new THREE.Face3( 0, 4, 5) );
        cPlane.computeBoundingSphere();

        //a plane
	var aPlaneColor = new THREE.Color( 0x00FF00 );       
        var aPlane = new THREE.Geometry();
	aPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	aPlane.vertices.push( vertices[2] );
        aPlane.vertices.push( vertices[0] );
        aPlane.vertices.push( vertices[7] );
        aPlane.vertices.push( vertices[9] );
        aPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        aPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        aPlane.computeBoundingSphere();
        
        //m plane
	var mPlaneColor = new THREE.Color( 0x0000FF );       
        var mPlane = new THREE.Geometry();
	mPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	mPlane.vertices.push( vertices[2] );
        mPlane.vertices.push( vertices[1] );
        mPlane.vertices.push( vertices[8] );
        mPlane.vertices.push( vertices[9] );
        mPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        mPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        mPlane.computeBoundingSphere();
        
        //r plane
	var rPlaneColor = new THREE.Color( 0xd3d3d3 );       
        var rPlane = new THREE.Geometry();
	rPlane.applyMatrix( new THREE.Matrix4().makeTranslation( 0, 0, 0 ) );

	rPlane.vertices.push( vertices[1] );
        rPlane.vertices.push( vertices[2] );
        rPlane.vertices.push( vertices[11] );
        rPlane.vertices.push( vertices[12] );
        rPlane.faces.push( new THREE.Face3( 0, 1, 2 ) );
        rPlane.faces.push( new THREE.Face3( 2, 3, 0 ) );
        rPlane.computeBoundingSphere();
    
    //Materials
    var cMaterial = new THREE.MeshBasicMaterial( {
		color: cPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );

    var aMaterial = new THREE.MeshBasicMaterial( {
		color: aPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
    var mMaterial = new THREE.MeshBasicMaterial( {
		color: mPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
    var rMaterial = new THREE.MeshBasicMaterial( {
		color: rPlaneColor,
		shading: THREE.FlatShading,
		side: THREE.DoubleSide,
		transparent: false
	} );
	
    
    var axisMaterial = new THREE.LineBasicMaterial({
        	color: 0x7F00FF, //purple
        	opacity: .5,
        	linewidth: 3
    });
    
    
    var y = vertices[7].y;
    
    var axisPts = [ new THREE.Vector3(0,y,0),
    		    vertices[12].clone().multiplyScalar(1.2).setY(y),
    		    vertices[8].clone().multiplyScalar(1.2).setY(y),
    		    vertices[10].clone().multiplyScalar(1.2).setY(y),
    		    new THREE.Vector3(0,vertices[1].y,0).multiplyScalar(1.2)
    	];
    //Return geometry object with axes
    function axis() {
    	var y = vertices[7].y;
    	var bottom = new THREE.Vector3(0,y,0);
    	
    	var geometry = new THREE.Geometry();
    	geometry.vertices.push(axisPts[1]);
    	geometry.vertices.push(axisPts[0]);
    	
    	var geometry2 = new THREE.Geometry();
    	geometry2.vertices.push(axisPts[2]);
    	geometry2.vertices.push(axisPts[0]);
    	
    	var geometry3 = new THREE.Geometry();
    	geometry3.vertices.push(axisPts[3]);
    	geometry3.vertices.push(axisPts[0]);
    	
    	var geometry4 = new THREE.Geometry();
    	geometry4.vertices.push(axisPts[4]);
    	geometry4.vertices.push(axisPts[0]);
    	
    	THREE.GeometryUtils.merge(geometry, geometry2);
    	THREE.GeometryUtils.merge(geometry, geometry3);
    	THREE.GeometryUtils.merge(geometry, geometry4);
    	
    	return geometry;	
    }
    
    // Pass in positions of axis labels
    // Return array with labels
    function axisLabels(a0, a1, a2, c) {
    	
    	var axisLabels = [];
    	var attrDict = { size:.25,
    			 height:.01,
    			 bevelEnabled:false
    			};
        
    	var cTextGeo = new THREE.TextGeometry("c", attrDict);
	cTextGeo.computeBoundingBox();
	cTextGeo.computeVertexNormals();
	var cLabelMesh = new THREE.Mesh(cTextGeo, axisMaterial);
	cLabelMesh.position = c;
	axisLabels.push(cLabelMesh);
	
	var a0TextGeo = new THREE.TextGeometry("a1", attrDict);
    						
	var a0LabelMesh = new THREE.Mesh(a0TextGeo, axisMaterial);
	a0LabelMesh.position = a0;
	axisLabels.push(a0LabelMesh);
	
	var a1TextGeo = new THREE.TextGeometry("a2", attrDict);
	var a1LabelMesh = new THREE.Mesh(a1TextGeo, axisMaterial);
	a1LabelMesh.position = a1;
	axisLabels.push(a1LabelMesh);
	
	var a2TextGeo = new THREE.TextGeometry("a3", attrDict);
	var a2LabelMesh = new THREE.Mesh(a2TextGeo, axisMaterial);
	a2LabelMesh.position = a2;
	axisLabels.push(a2LabelMesh);

    	return axisLabels;
    }

    cPlaneMesh = new THREE.Mesh(cPlane, cMaterial );
    scene.add( cPlaneMesh );

    aPlaneMesh = new THREE.Mesh(aPlane, aMaterial );
    scene.add( aPlaneMesh );
    
    mPlaneMesh = new THREE.Mesh(mPlane, mMaterial );
    scene.add( mPlaneMesh );
    
    rPlaneMesh = new THREE.Mesh(rPlane, rMaterial );
    scene.add( rPlaneMesh );
    
    var axis = new THREE.Line(axis(), axisMaterial);
    scene.add( axis );
    
    var axisLabels = axisLabels(axisPts[1], axisPts[2], axisPts[3], axisPts[4]);
    for(var i = 0; i < axisLabels.length; ++i) {
    	scene.add(axisLabels[i]);
    }
    

    //setup GUI
    
    gui = gui();
    gui.add( parameters, 'reset' ).name("Reset");
    gui.open();
}

function animate() {

	requestAnimationFrame( animate );  
	renderer.render( scene, camera );
    update();
}
 
function resetLattice()
{
    
}      

function gui() {
    var _gui = new dat.GUI();
    
    var cPlanesGUI = _gui.addFolder('C Planes');
    var aPlanesGUI = _gui.addFolder('A Planes');
    var mPlanesGUI = _gui.addFolder('M Planes');
    var rPlanesGUI = _gui.addFolder('R Planes');
    
    parameters = 	{
    			cPlaneVisible: true,
        		aPlaneVisible: true,
        		mPlaneVisible: true,
        		rPlaneVisible: true,
        		axisVisible: false,
			reset: function() { resetLattice() }
		};
    var cPlaneVisible = cPlanesGUI.add( parameters, 'cPlaneVisible' ).name('C Plane').listen();
	cPlaneVisible.onChange(function(value) 
	{   //c Plane
        if(value) scene.add( cPlaneMesh );
        
        else scene.remove(cPlaneMesh);
        
    });
     var aPlaneVisible = aPlanesGUI.add( parameters, 'aPlaneVisible' ).name('A Plane').listen();
	aPlaneVisible.onChange(function(value) 
	{   
    	if(value) scene.add( aPlaneMesh );
        
        else scene.remove(aPlaneMesh);
    });
     var mPlaneVisible = mPlanesGUI.add( parameters, 'mPlaneVisible' ).name('M Plane').listen();
	mPlaneVisible.onChange(function(value) 
	{   
    	if(value) scene.add( mPlaneMesh );
        
        else scene.remove(mPlaneMesh);
    });
    var rPlaneVisible = rPlanesGUI.add( parameters, 'rPlaneVisible' ).name('R Plane').listen();
	rPlaneVisible.onChange(function(value) 
	{   
    	if(value) scene.add( rPlaneMesh );
        
        else scene.remove(rPlaneMesh);
    });
    var axisVisible = _gui.add( parameters, 'axisVisible' ).name('Axis').listen();
	axisVisible.onChange(function(value) 
	{   
	if(value) scene.add( axis );
        
        else scene.remove( axis );
    
    });
    
    return _gui;
    
}

function update()
{
    /*
	if ( keyboard.pressed("a") ) {
    
    }
	if ( keyboard.pressed("m") ) {
    
    }
	if ( keyboard.pressed("r") ) {
    
    }
	*/
    
	controls.update();
	//stats.update();
}
</script>
  </body>
</html>
